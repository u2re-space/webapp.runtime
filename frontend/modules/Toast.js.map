{"version":3,"file":"Toast.js","sources":["../../src/frontend/shared/Toast.ts"],"sourcesContent":["/**\n * Standalone Toast System\n * Works independently in any context: PWA, Chrome Extension (content script, popup, service worker), vanilla JS\n * No dependencies on fest/lure or other framework libraries\n */\n\nexport type ToastKind = \"info\" | \"success\" | \"warning\" | \"error\";\nexport type ToastPosition = \"top\" | \"bottom\" | \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n\nexport interface ToastOptions {\n    message: string;\n    kind?: ToastKind;\n    duration?: number;\n    persistent?: boolean;\n    position?: ToastPosition;\n    onClick?: () => void;\n}\n\nexport interface ToastLayerConfig {\n    containerId?: string;\n    position?: ToastPosition;\n    maxToasts?: number;\n    zIndex?: number;\n}\n\n// Default configuration\nconst DEFAULT_CONFIG: Required<ToastLayerConfig> = {\n    containerId: \"rs-toast-layer\",\n    position: \"bottom\",\n    maxToasts: 5,\n    zIndex: 2147483647\n};\n\n// Toast CSS styles (inlined for isolation)\nconst TOAST_STYLES = `\n.rs-toast-layer {\n    position: fixed;\n    z-index: var(--rs-toast-z, 2147483647);\n    pointer-events: none;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 1rem;\n    gap: 0.5rem;\n    max-block-size: 80dvb;\n    overflow: hidden;\n    box-sizing: border-box;\n}\n\n.rs-toast-layer[data-position=\"bottom\"],\n.rs-toast-layer:not([data-position]) {\n    inset-block-end: 10dvb;\n    inset-inline: 0;\n    justify-content: flex-end;\n}\n\n.rs-toast-layer[data-position=\"top\"] {\n    inset-block-start: 10dvb;\n    inset-inline: 0;\n    justify-content: flex-start;\n}\n\n.rs-toast-layer[data-position=\"top-left\"] {\n    inset-block-start: 10dvb;\n    inset-inline-start: 0;\n    align-items: flex-start;\n}\n\n.rs-toast-layer[data-position=\"top-right\"] {\n    inset-block-start: 10dvb;\n    inset-inline-end: 0;\n    align-items: flex-end;\n}\n\n.rs-toast-layer[data-position=\"bottom-left\"] {\n    inset-block-end: 10dvb;\n    inset-inline-start: 0;\n    align-items: flex-start;\n}\n\n.rs-toast-layer[data-position=\"bottom-right\"] {\n    inset-block-end: 10dvb;\n    inset-inline-end: 0;\n    align-items: flex-end;\n}\n\n.rs-toast {\n    --toast-bg: oklch(from var(--surface-color, #1a1a1a) l c h / 0.85);\n    --toast-text: var(--on-surface-color, #ffffff);\n    --toast-radius: 9999px;\n    --toast-shadow: 0 2px 8px rgba(0,0,0,0.25);\n\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    padding: 0.5rem 1rem;\n    max-inline-size: min(90vw, 32rem);\n    inline-size: fit-content;\n\n    border-radius: var(--toast-radius);\n    background: var(--toast-bg);\n    box-shadow: var(--toast-shadow);\n    backdrop-filter: blur(12px) saturate(140%);\n    color: var(--toast-text);\n\n    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 0.875rem;\n    font-weight: 500;\n    letter-spacing: 0.01em;\n    line-height: 1.4;\n    white-space: nowrap;\n\n    pointer-events: auto;\n    user-select: none;\n    cursor: default;\n\n    opacity: 0;\n    transform: translateY(100%) scale(0.9);\n    transition:\n        opacity 160ms ease-out,\n        transform 160ms cubic-bezier(0.16, 1, 0.3, 1),\n        background-color 100ms ease;\n}\n\n.rs-toast[data-visible] {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n}\n\n.rs-toast:active {\n    transform: scale(0.98);\n}\n\n.rs-toast[data-kind=\"success\"] {\n    --toast-bg: oklch(from var(--color-success, #22c55e) l c h / 0.9);\n}\n\n.rs-toast[data-kind=\"warning\"] {\n    --toast-bg: oklch(from var(--color-warning, #f59e0b) l c h / 0.9);\n}\n\n.rs-toast[data-kind=\"error\"] {\n    --toast-bg: oklch(from var(--color-error, #ef4444) l c h / 0.9);\n}\n\n@media (prefers-reduced-motion: reduce) {\n    .rs-toast,\n    .rs-toast[data-visible] {\n        transition-duration: 0ms;\n        transform: none;\n    }\n}\n`;\n\n// Track style injection per document\nconst injectedDocs = new WeakSet<Document>();\n\n// Toast layer instances per config\nconst toastLayers = new Map<string, HTMLElement>();\n\n/**\n * Ensure styles are injected into the document\n */\nconst ensureStyles = (doc: Document = document): void => {\n    if (injectedDocs.has(doc)) return;\n\n    const style = doc.createElement(\"style\");\n    style.id = \"__rs-toast-styles__\";\n    style.textContent = TOAST_STYLES;\n    (doc.head || doc.documentElement).appendChild(style);\n    injectedDocs.add(doc);\n};\n\n/**\n * Get or create a toast layer container\n */\nconst getToastLayer = (config: Required<ToastLayerConfig>, doc: Document = document): HTMLElement => {\n    const key = `${config.containerId}-${config.position}`;\n\n    if (toastLayers.has(key)) {\n        const existing = toastLayers.get(key)!;\n        if (existing.isConnected) return existing;\n        toastLayers.delete(key);\n    }\n\n    ensureStyles(doc);\n\n    let layer = doc.getElementById(config.containerId);\n    if (!layer) {\n        layer = doc.createElement(\"div\");\n        layer.id = config.containerId;\n        layer.className = \"rs-toast-layer\";\n        doc.body.appendChild(layer);\n    }\n\n    layer.setAttribute(\"data-position\", config.position);\n    layer.style.setProperty(\"--rs-toast-z\", String(config.zIndex));\n\n    toastLayers.set(key, layer);\n    return layer;\n};\n\n/**\n * Create and show a toast notification\n */\nexport const showToast = (options: ToastOptions | string): HTMLElement | null => {\n    // Handle string shorthand\n    const opts: ToastOptions = typeof options === \"string\" ? { message: options } : options;\n\n    const {\n        message,\n        kind = \"info\",\n        duration = 3000,\n        persistent = false,\n        position = \"bottom\",\n        onClick\n    } = opts;\n\n    // Check for document availability (service worker context)\n    if (typeof document === \"undefined\") {\n        // In service worker context, try to broadcast to clients\n        broadcastToast(opts);\n        return null;\n    }\n\n    const config: Required<ToastLayerConfig> = {\n        ...DEFAULT_CONFIG,\n        position\n    };\n\n    const layer = getToastLayer(config);\n\n    // Limit number of toasts\n    while (layer.children.length >= config.maxToasts) {\n        layer.firstChild?.remove();\n    }\n\n    const toast = document.createElement(\"div\");\n    toast.className = \"rs-toast\";\n    toast.setAttribute(\"data-kind\", kind);\n    toast.setAttribute(\"role\", \"alert\");\n    toast.setAttribute(\"aria-live\", kind === \"error\" ? \"assertive\" : \"polite\");\n    toast.textContent = message;\n\n    layer.appendChild(toast);\n\n    // Trigger enter animation\n    requestAnimationFrame(() => {\n        toast.setAttribute(\"data-visible\", \"\");\n    });\n\n    const removeToast = () => {\n        toast.removeAttribute(\"data-visible\");\n        setTimeout(() => {\n            toast.remove();\n        }, 200);\n    };\n\n    // Auto-remove after duration\n    if (!persistent) {\n        setTimeout(removeToast, duration);\n    }\n\n    // Click handler\n    toast.addEventListener(\"click\", () => {\n        onClick?.();\n        removeToast();\n    });\n\n    return toast;\n};\n\n/**\n * Convenience methods for different toast kinds\n */\nexport const showSuccess = (message: string, duration?: number) =>\n    showToast({ message, kind: \"success\", duration });\n\nexport const showError = (message: string, duration?: number) =>\n    showToast({ message, kind: \"error\", duration });\n\nexport const showWarning = (message: string, duration?: number) =>\n    showToast({ message, kind: \"warning\", duration });\n\nexport const showInfo = (message: string, duration?: number) =>\n    showToast({ message, kind: \"info\", duration });\n\n/**\n * Broadcast toast to all clients (for service worker context)\n */\nconst broadcastToast = (options: ToastOptions): void => {\n    try {\n        const channel = new BroadcastChannel(\"rs-toast\");\n        channel.postMessage({ type: \"show-toast\", options });\n        channel.close();\n    } catch (e) {\n        console.warn(\"[Toast] Broadcast failed:\", e);\n    }\n};\n\n/**\n * Listen for toast broadcasts (call in main thread contexts)\n */\nexport const listenForToasts = (): () => void => {\n    if (typeof BroadcastChannel === \"undefined\") return () => {};\n\n    const channel = new BroadcastChannel(\"rs-toast\");\n    const handler = (event: MessageEvent) => {\n        if (event.data?.type === \"show-toast\" && event.data?.options) {\n            showToast(event.data.options);\n        }\n    };\n    channel.addEventListener(\"message\", handler);\n    return () => {\n        channel.removeEventListener(\"message\", handler);\n        channel.close();\n    };\n};\n\n/**\n * Clear all toasts from a layer\n */\nexport const clearToasts = (position: ToastPosition = \"bottom\"): void => {\n    const key = `${DEFAULT_CONFIG.containerId}-${position}`;\n    const layer = toastLayers.get(key);\n    if (layer) {\n        layer.innerHTML = \"\";\n    }\n};\n\n/**\n * Initialize toast listener for receiving broadcasts\n * Call this in main thread contexts (content scripts, popup, etc.)\n */\nexport const initToastReceiver = (): (() => void) => {\n    return listenForToasts();\n};\n\n// Default export for convenience\nexport default {\n    show: showToast,\n    success: showSuccess,\n    error: showError,\n    warning: showWarning,\n    info: showInfo,\n    clear: clearToasts,\n    listen: listenForToasts,\n    init: initToastReceiver\n};\n"],"names":[],"mappings":"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"}