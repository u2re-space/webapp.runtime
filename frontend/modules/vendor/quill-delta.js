import{g as e}from"./dompurify.js";import{r as t}from"./fast-diff.js";import{r as n}from"./lodash.clonedeep.js";import{r}from"./lodash.isequal.js";var s,i,o={exports:{}},u={},a={};function f(){return i||(i=1,Object.defineProperty(a,"__esModule",{value:!0}),function(e){e.length=function(e){return"number"==typeof e.delete?e.delete:"number"==typeof e.retain?e.retain:"object"==typeof e.retain&&null!==e.retain?1:"string"==typeof e.insert?e.insert.length:1}}(e||(e={})),a.default=e),a;var e}var p,l,h={},c=(l||(l=1,function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.AttributeMap=i.OpIterator=i.Op=void 0;const o=t(),a=n(),l=r(),c=function(){if(s)return u;s=1,Object.defineProperty(u,"__esModule",{value:!0});const e=n(),t=r();var i;return function(n){n.compose=function(t={},n={},r=!1){"object"!=typeof t&&(t={}),"object"!=typeof n&&(n={});let s=e(n);r||(s=Object.keys(s).reduce((e,t)=>(null!=s[t]&&(e[t]=s[t]),e),{}));for(const e in t)void 0!==t[e]&&void 0===n[e]&&(s[e]=t[e]);return Object.keys(s).length>0?s:void 0},n.diff=function(e={},n={}){"object"!=typeof e&&(e={}),"object"!=typeof n&&(n={});const r=Object.keys(e).concat(Object.keys(n)).reduce((r,s)=>(t(e[s],n[s])||(r[s]=void 0===n[s]?null:n[s]),r),{});return Object.keys(r).length>0?r:void 0},n.invert=function(e={},t={}){e=e||{};const n=Object.keys(t).reduce((n,r)=>(t[r]!==e[r]&&void 0!==e[r]&&(n[r]=t[r]),n),{});return Object.keys(e).reduce((n,r)=>(e[r]!==t[r]&&void 0===t[r]&&(n[r]=null),n),n)},n.transform=function(e,t,n=!1){if("object"!=typeof e)return t;if("object"!=typeof t)return;if(!n)return t;const r=Object.keys(t).reduce((n,r)=>(void 0===e[r]&&(n[r]=t[r]),n),{});return Object.keys(r).length>0?r:void 0}}(i||(i={})),u.default=i,u}();i.AttributeMap=c.default;const d=f();i.Op=d.default;const b=function(){if(p)return h;p=1,Object.defineProperty(h,"__esModule",{value:!0});const e=f();return h.default=class{constructor(e){this.ops=e,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(t){t||(t=1/0);const n=this.ops[this.index];if(n){const r=this.offset,s=e.default.length(n);if(t>=s-r?(t=s-r,this.index+=1,this.offset=0):this.offset+=t,"number"==typeof n.delete)return{delete:t};{const e={};return n.attributes&&(e.attributes=n.attributes),"number"==typeof n.retain?e.retain=t:"object"==typeof n.retain&&null!==n.retain?e.retain=n.retain:e.insert="string"==typeof n.insert?n.insert.substr(r,t):n.insert,e}}return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?e.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const e=this.ops[this.index];return e?"number"==typeof e.delete?"delete":"number"==typeof e.retain||"object"==typeof e.retain&&null!==e.retain?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(0===this.offset)return this.ops.slice(this.index);{const e=this.offset,t=this.index,n=this.next(),r=this.ops.slice(this.index);return this.offset=e,this.index=t,[n].concat(r)}}return[]}},h}();i.OpIterator=b.default;const y=String.fromCharCode(0),m=(e,t)=>{if("object"!=typeof e||null===e)throw new Error("cannot retain a "+typeof e);if("object"!=typeof t||null===t)throw new Error("cannot retain a "+typeof t);const n=Object.keys(e)[0];if(!n||n!==Object.keys(t)[0])throw new Error(`embed types not matched: ${n} != ${Object.keys(t)[0]}`);return[n,e[n],t[n]]};class g{constructor(e){this.ops=Array.isArray(e)?e:null!=e&&Array.isArray(e.ops)?e.ops:[]}static registerEmbed(e,t){this.handlers[e]=t}static unregisterEmbed(e){delete this.handlers[e]}static getHandler(e){const t=this.handlers[e];if(!t)throw new Error(`no handlers for embed type "${e}"`);return t}insert(e,t){const n={};return"string"==typeof e&&0===e.length?this:(n.insert=e,null!=t&&"object"==typeof t&&Object.keys(t).length>0&&(n.attributes=t),this.push(n))}delete(e){return e<=0?this:this.push({delete:e})}retain(e,t){if("number"==typeof e&&e<=0)return this;const n={retain:e};return null!=t&&"object"==typeof t&&Object.keys(t).length>0&&(n.attributes=t),this.push(n)}push(e){let t=this.ops.length,n=this.ops[t-1];if(e=a(e),"object"==typeof n){if("number"==typeof e.delete&&"number"==typeof n.delete)return this.ops[t-1]={delete:n.delete+e.delete},this;if("number"==typeof n.delete&&null!=e.insert&&(t-=1,n=this.ops[t-1],"object"!=typeof n))return this.ops.unshift(e),this;if(l(e.attributes,n.attributes)){if("string"==typeof e.insert&&"string"==typeof n.insert)return this.ops[t-1]={insert:n.insert+e.insert},"object"==typeof e.attributes&&(this.ops[t-1].attributes=e.attributes),this;if("number"==typeof e.retain&&"number"==typeof n.retain)return this.ops[t-1]={retain:n.retain+e.retain},"object"==typeof e.attributes&&(this.ops[t-1].attributes=e.attributes),this}}return t===this.ops.length?this.ops.push(e):this.ops.splice(t,0,e),this}chop(){const e=this.ops[this.ops.length-1];return e&&"number"==typeof e.retain&&!e.attributes&&this.ops.pop(),this}filter(e){return this.ops.filter(e)}forEach(e){this.ops.forEach(e)}map(e){return this.ops.map(e)}partition(e){const t=[],n=[];return this.forEach(r=>{(e(r)?t:n).push(r)}),[t,n]}reduce(e,t){return this.ops.reduce(e,t)}changeLength(){return this.reduce((e,t)=>t.insert?e+d.default.length(t):t.delete?e-t.delete:e,0)}length(){return this.reduce((e,t)=>e+d.default.length(t),0)}slice(e=0,t=1/0){const n=[],r=new b.default(this.ops);let s=0;for(;s<t&&r.hasNext();){let i;s<e?i=r.next(e-s):(i=r.next(t-s),n.push(i)),s+=d.default.length(i)}return new g(n)}compose(e){const t=new b.default(this.ops),n=new b.default(e.ops),r=[],s=n.peek();if(null!=s&&"number"==typeof s.retain&&null==s.attributes){let e=s.retain;for(;"insert"===t.peekType()&&t.peekLength()<=e;)e-=t.peekLength(),r.push(t.next());s.retain-e>0&&n.next(s.retain-e)}const i=new g(r);for(;t.hasNext()||n.hasNext();)if("insert"===n.peekType())i.push(n.next());else if("delete"===t.peekType())i.push(t.next());else{const e=Math.min(t.peekLength(),n.peekLength()),r=t.next(e),s=n.next(e);if(s.retain){const o={};if("number"==typeof r.retain)o.retain="number"==typeof s.retain?e:s.retain;else if("number"==typeof s.retain)null==r.retain?o.insert=r.insert:o.retain=r.retain;else{const e=null==r.retain?"insert":"retain",[t,n,i]=m(r[e],s.retain),u=g.getHandler(t);o[e]={[t]:u.compose(n,i,"retain"===e)}}const u=c.default.compose(r.attributes,s.attributes,"number"==typeof r.retain);if(u&&(o.attributes=u),i.push(o),!n.hasNext()&&l(i.ops[i.ops.length-1],o)){const e=new g(t.rest());return i.concat(e).chop()}}else"number"==typeof s.delete&&("number"==typeof r.retain||"object"==typeof r.retain&&null!==r.retain)&&i.push(s)}return i.chop()}concat(e){const t=new g(this.ops.slice());return e.ops.length>0&&(t.push(e.ops[0]),t.ops=t.ops.concat(e.ops.slice(1))),t}diff(e,t){if(this.ops===e.ops)return new g;const n=[this,e].map(t=>t.map(n=>{if(null!=n.insert)return"string"==typeof n.insert?n.insert:y;throw new Error("diff() called "+(t===e?"on":"with")+" non-document")}).join("")),r=new g,s=o(n[0],n[1],t,!0),i=new b.default(this.ops),u=new b.default(e.ops);return s.forEach(e=>{let t=e[1].length;for(;t>0;){let n=0;switch(e[0]){case o.INSERT:n=Math.min(u.peekLength(),t),r.push(u.next(n));break;case o.DELETE:n=Math.min(t,i.peekLength()),i.next(n),r.delete(n);break;case o.EQUAL:n=Math.min(i.peekLength(),u.peekLength(),t);const e=i.next(n),s=u.next(n);l(e.insert,s.insert)?r.retain(n,c.default.diff(e.attributes,s.attributes)):r.push(s).delete(n)}t-=n}}),r.chop()}eachLine(e,t="\n"){const n=new b.default(this.ops);let r=new g,s=0;for(;n.hasNext();){if("insert"!==n.peekType())return;const i=n.peek(),o=d.default.length(i)-n.peekLength(),u="string"==typeof i.insert?i.insert.indexOf(t,o)-o:-1;if(u<0)r.push(n.next());else if(u>0)r.push(n.next(u));else{if(!1===e(r,n.next(1).attributes||{},s))return;s+=1,r=new g}}r.length()>0&&e(r,{},s)}invert(e){const t=new g;return this.reduce((n,r)=>{if(r.insert)t.delete(d.default.length(r));else{if("number"==typeof r.retain&&null==r.attributes)return t.retain(r.retain),n+r.retain;if(r.delete||"number"==typeof r.retain){const s=r.delete||r.retain;return e.slice(n,n+s).forEach(e=>{r.delete?t.push(e):r.retain&&r.attributes&&t.retain(d.default.length(e),c.default.invert(r.attributes,e.attributes))}),n+s}if("object"==typeof r.retain&&null!==r.retain){const s=e.slice(n,n+1),i=new b.default(s.ops).next(),[o,u,a]=m(r.retain,i.insert),f=g.getHandler(o);return t.retain({[o]:f.invert(u,a)},c.default.invert(r.attributes,i.attributes)),n+1}}return n},0),t.chop()}transform(e,t=!1){if(t=!!t,"number"==typeof e)return this.transformPosition(e,t);const n=e,r=new b.default(this.ops),s=new b.default(n.ops),i=new g;for(;r.hasNext()||s.hasNext();)if("insert"!==r.peekType()||!t&&"insert"===s.peekType())if("insert"===s.peekType())i.push(s.next());else{const e=Math.min(r.peekLength(),s.peekLength()),n=r.next(e),o=s.next(e);if(n.delete)continue;if(o.delete)i.push(o);else{const r=n.retain,s=o.retain;let u="object"==typeof s&&null!==s?s:e;if("object"==typeof r&&null!==r&&"object"==typeof s&&null!==s){const e=Object.keys(r)[0];if(e===Object.keys(s)[0]){const n=g.getHandler(e);n&&(u={[e]:n.transform(r[e],s[e],t)})}}i.retain(u,c.default.transform(n.attributes,o.attributes,t))}}else i.retain(d.default.length(r.next()));return i.chop()}transformPosition(e,t=!1){t=!!t;const n=new b.default(this.ops);let r=0;for(;n.hasNext()&&r<=e;){const s=n.peekLength(),i=n.peekType();n.next(),"delete"!==i?("insert"===i&&(r<e||!t)&&(e+=s),r+=s):e-=Math.min(s,e-r)}return e}}g.Op=d.default,g.OpIterator=b.default,g.AttributeMap=c.default,g.handlers={},i.default=g,e.exports=g,e.exports.default=g}(o,o.exports)),o.exports);const d=/*@__PURE__*/e(c);export{d as D,c as a};