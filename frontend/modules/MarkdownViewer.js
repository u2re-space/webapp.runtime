import"./fest/dom.js";import"./fest/core.js";import"./fest/object.js";import{H as t}from"./fest/lure.js";import{m as n}from"./vendor/marked.js";import{m as e}from"./vendor/marked-katex-extension.js";import{D as o}from"./vendor/isomorphic-dompurify.js";n?.use?.(e({throwOnError:!1,nonStandard:!0,output:"mathml",strict:!1}));class i{options;view=null;container=null;content="";constructor(t={}){this.options={content:"",title:"Markdown Viewer",showTitle:!0,showActions:!0,...t},this.content=this.options.content||""}render(){return this.container=t`<div class="markdown-viewer-container">
      ${this.options.showTitle?t`<div class="viewer-header">
        <h3>${this.options.title}</h3>
        ${this.options.showActions?t`<div class="viewer-actions">
          <button class="btn btn-icon" data-action="copy" title="Copy content" aria-label="Copy content">
            <ui-icon icon="copy" size="20" icon-style="duotone"></ui-icon>
            <span class="btn-text">Copy</span>
          </button>
          <button class="btn btn-icon" data-action="download" title="Download as markdown" aria-label="Download as markdown">
            <ui-icon icon="download" size="20" icon-style="duotone"></ui-icon>
            <span class="btn-text">Download</span>
          </button>
          <button class="btn btn-icon" data-action="print" title="Print content" aria-label="Print content">
            <ui-icon icon="printer" size="20" icon-style="duotone"></ui-icon>
            <span class="btn-text">Print</span>
          </button>
        </div>`:""}
      </div>`:""}

      <div class="viewer-content"></div>
    </div>`,this.initializeViewer(this.container),this.container}setContent(t){this.content=t,this.view&&this.view.setMarkdown(t),this.writeToCache(t).catch(console.warn.bind(console))}async loadFromCache(){try{if(navigator?.storage){const t=await import("./fest/core.js").then(t=>t.provide("/user/cache/last.md"));return t?.text?.()||null}return localStorage.getItem("$cached-md$")}catch(t){return console.warn("[MarkdownViewer] Failed to load from cache:",t),null}}async writeToCache(t){try{if(navigator?.storage){const n=await import("./fest/core.js").then(t=>t.provide("/user/cache/last.md",!0));await(n?.write?.(t)),await(n?.close?.())}else localStorage.setItem("$cached-md$",t)}catch(n){console.warn("[MarkdownViewer] Failed to write to cache:",n)}}getContent(){return this.content}async copyContent(){try{await navigator.clipboard.writeText(this.content),this.options.onCopy?.(this.content)}catch(t){console.warn("Failed to copy content:",t);const n=document.createElement("textarea");n.value=this.content,document.body.append(n),n.select(),document.execCommand("copy"),n.remove(),this.options.onCopy?.(this.content)}}downloadContent(){const t=new Blob([this.content],{type:"text/markdown"}),n=URL.createObjectURL(t),e=document.createElement("a");e.href=n,e.download=`markdown-content-${/* @__PURE__ */(new Date).toISOString().split("T")[0]}.md`,document.body.append(e),e.click(),e.remove(),URL.revokeObjectURL(n),this.options.onDownload?.(this.content)}printContent(){try{const t=this.container?.querySelector(".markdown-viewer-content");if(!t)return void console.error("[MarkdownViewer] Could not find markdown content for printing");const n=new URL("/print",window.location.origin);if(n.searchParams.set("content",t.innerHTML),n.searchParams.set("title",this.options.title||"Markdown Content"),!window.open(n.toString(),"_blank","width=800,height=600"))return console.warn("[MarkdownViewer] Failed to open print window - popup blocked?"),void this.printCurrentContent();this.options.onPrint?.(this.content)}catch(t){console.error("[MarkdownViewer] Error printing content:",t),this.printCurrentContent()}}printCurrentContent(){const t=this.container?.querySelector(".markdown-viewer-content");t&&(t.setAttribute("data-print","true"),window.print(),setTimeout(()=>{t.removeAttribute("data-print")},1e3))}initializeViewer(t){const e=t.querySelector(".viewer-content");if(!e)return void console.error("[MarkdownViewer] Content container not found");const i=document.createElement("div");i.className="markdown-body markdown-viewer-content",i.setAttribute("data-print","true"),i.style.cssText="\n      padding: 2rem;\n      min-height: 300px;\n      border-radius: var(--basic-radius-lg, 12px);\n      overflow-wrap: break-word;\n      word-wrap: break-word;\n      color-scheme: inherit;\n    ",e.innerHTML="",e.append(i),this.view={setMarkdown:(t="")=>{try{const e=n.parse((t||"").trim()),r=o?.sanitize?.((e||"").trim())||"";i.innerHTML=r,console.log("[MarkdownViewer] Markdown rendered successfully:",{inputLength:t.length,outputLength:r.length,hasContent:!!r})}catch(e){console.error("[MarkdownViewer] Error rendering markdown:",e),i.innerHTML=`<div style="color: red; padding: 1rem; background: #fee; border: 1px solid #fcc; border-radius: 4px;">Error parsing markdown: ${e.message}</div>`}}},console.log("[MarkdownViewer] Created simple div-based viewer"),this.content&&(console.log("[MarkdownViewer] Setting initial content:",this.content.substring(0,100)+"..."),this.view.setMarkdown(this.content)),t.addEventListener("click",t=>{const n=t.target.getAttribute("data-action");"copy"===n?this.copyContent():"download"===n?this.downloadContent():"print"===n&&this.printContent()})}}function r(t){return new i(t)}export{i as M,r as c};