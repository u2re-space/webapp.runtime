import{l as t,s as n}from"./RuntimeSettings.js";import{g as i}from"./RecognizeData.js";export{D as DEFAULT_INSTRUCTION_TEMPLATES,b as buildInstructionPrompt}from"./RecognizeData.js";const s=i,o=async()=>{try{const n=await t(),i=n?.ai?.customInstructions||[],s=n?.ai?.activeInstructionId;if(console.log("[CustomInstructions] getActiveInstruction - activeId:",s),console.log("[CustomInstructions] getActiveInstruction - instructions count:",i.length),!s)return console.log("[CustomInstructions] No activeInstructionId set"),null;const o=i.find(t=>t.id===s);return o?console.log("[CustomInstructions] Found active instruction:",o.label):(console.warn("[CustomInstructions] activeInstructionId not found in instructions:",s),console.log("[CustomInstructions] Available IDs:",i.map(t=>t.id))),o||null}catch(n){return console.error("[CustomInstructions] Error in getActiveInstruction:",n),null}},c=async()=>{const t=await o(),n=t?.instruction||"";return console.log("[CustomInstructions] getActiveInstructionText:",n?`"${n.substring(0,50)}..."`:"(empty)"),n},r=async i=>{const s=await t(),o={...s,ai:{...s.ai,activeInstructionId:i||""}};await n(o)},a=async(i,o)=>{const c=await t(),r=c?.ai?.customInstructions||[],a={id:s(),label:i.trim()||"Untitled",instruction:o.trim(),enabled:!0,order:r.length},u={...c,ai:{...c.ai,customInstructions:[...r,a]}};return await n(u),a},u=async i=>{if(!i.length)return[];const o=await t(),c=o?.ai?.customInstructions||[],r=i.map((t,n)=>({id:s(),label:t.label.trim()||"Untitled",instruction:t.instruction.trim(),enabled:t.enabled??!0,order:c.length+n})),a={...o,ai:{...o.ai,customInstructions:[...c,...r]}};return await n(a),r},e=async(i,s)=>{const o=await t(),c=o?.ai?.customInstructions||[],r=c.findIndex(t=>t.id===i);if(-1===r)return!1;c[r]={...c[r],...s};const a={...o,ai:{...o.ai,customInstructions:c}};return await n(a),!0},l=async i=>{const s=await t(),o=s?.ai?.customInstructions||[],c=o.filter(t=>t.id!==i);if(c.length===o.length)return!1;const r=s.ai?.activeInstructionId===i?"":s.ai?.activeInstructionId||"",a={...s,ai:{...s.ai,customInstructions:c,activeInstructionId:r}};return await n(a),!0};export{a as addInstruction,u as addInstructions,l as deleteInstruction,o as getActiveInstruction,c as getActiveInstructionText,r as setActiveInstruction,e as updateInstruction};