const e=".cache-meta.json";let t=null,i=null,n=null,s=null,o=null;const r=()=>{if(null!==s)return s;try{s=!("undefined"==typeof navigator||!("storage"in navigator)||"function"!=typeof navigator.storage?.getDirectory||"undefined"==typeof FileSystemFileHandle||"undefined"==typeof FileSystemDirectoryHandle)}catch{s=!1}return s},c=e=>e&&"string"==typeof e?e.replace(/[<>:"/\\|?*\x00-\x1F]/g,"_").replace(/\.{2,}/g,"_").replace(/^\./,"_").slice(0,200):"_empty_",a=async()=>o||(o=(async()=>{if(!r())return!1;try{const e=await navigator.storage.getDirectory();t=await e.getDirectoryHandle("icon-cache",{create:!0});const s=await l();return s&&1!==s.version&&await h(),i=await t.getDirectoryHandle("vector",{create:!0}),n=await t.getDirectoryHandle("raster",{create:!0}),await u(),!0}catch(e){return"undefined"!=typeof console&&console.warn?.("[icon-cache] OPFS init failed:",e),t=null,i=null,n=null,!1}})(),o),l=async()=>{if(!t)return null;try{const i=await t.getFileHandle(e),n=await i.getFile(),s=await n.text();return JSON.parse(s)}catch{return null}},u=async()=>{if(t)try{const i=await t.getFileHandle(e,{create:!0}),n=await i.createWritable(),s={version:1,created:Date.now(),lastAccess:Date.now()};await n.write(JSON.stringify(s)),await n.close()}catch{}},h=async()=>{if(t||await a()&&t)try{for await(const[i]of t.entries())i!==e&&await t.removeEntry(i,{recursive:!0});i=null,n=null,o=null,await a()}catch(s){"undefined"!=typeof console&&console.warn?.("[icon-cache] Failed to clear cache:",s)}};r()&&a().catch(()=>{});let d=null;const y=/* @__PURE__ */new Set;let p=[],f=!1;const g=()=>d||("undefined"==typeof document?null:(d=new CSSStyleSheet,document.adoptedStyleSheets?.push?.(d),d.insertRule('@property --icon-image { syntax: "<image>"; inherits: true; initial-value: linear-gradient(#0000, #0000); }',d.cssRules.length),d.insertRule(":where(ui-icon), :host(ui-icon) { --icon-image: linear-gradient(#0000, #0000); }",d.cssRules.length),d.insertRule(':where(ui-icon:not([icon])), :where(ui-icon[icon=""]), :host(ui-icon:not([icon])), :host(ui-icon[icon=""]) { background-color: transparent; }',d.cssRules.length),d)),m=(e,t,i)=>`${t}:${e}@${i}`,b=()=>{if(f=!1,0===p.length)return;const e=g();if(!e)return void(p=[]);const t=p.slice();p=[];for(const{selector:n,cssText:s,key:o}of t)if(!y.has(o))try{e.insertRule(`${n} { ${s} }`,e.cssRules.length),y.add(o)}catch(i){"undefined"!=typeof console&&console.warn?.("[icon-registry] Failed to insert rule:",i)}},v=/* @__PURE__ */new Map,w=/* @__PURE__ */new Map,k=32,R=[];let z=!1;const S=()=>{z||0===R.length||(z=!0,setTimeout(A,500))},A=()=>{z=!1;const e=R.splice(0,Math.min(4,R.length));for(const t of e)F(t.name,t.creator,t.retries).then(t.resolve).catch(t.reject);S()},x=(e,t)=>{let i;const n=new Promise((e,n)=>{i=setTimeout(()=>n(new Error("Timeout")),t)});return Promise.race([e,n]).finally(()=>clearTimeout(i))},I="undefined"!=typeof globalThis?globalThis:{},U=(()=>{try{if("undefined"!=typeof document&&"string"==typeof document.baseURI&&"about:blank"!==document.baseURI)return document.baseURI}catch{}try{const{location:e}=I;if(e?.href&&"about:blank"!==e.href)return e.href;if(e?.origin)return e.origin}catch{}})(),O=e=>e?`url("${e}")`:"none",C=e=>{if(!e||"string"!=typeof e)return"";const t=w.get(e);if(t)return t;let i=e;if("function"==typeof URL)try{i=U?new URL(e,U).href:new URL(e).href}catch{try{i=new URL(e,I.location?.origin??void 0).href}catch{i=e}}return w.set(e,i),w.has(i)||w.set(i,i),i},M=/* @__PURE__ */new Map,L=e=>{(!Number.isFinite(e)||e<=0)&&(e=k);const t=Math.max(e,k),i=2**Math.ceil(Math.log2(t));return Math.min(512,i)},$=e=>"string"!=typeof e?"":e.replace(/[_\s]+/g,"-").replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([A-Z])([A-Z][a-z])/g,"$1-$2").toLowerCase(),P=e=>{if("string"!=typeof e||!e)return!1;if("undefined"==typeof URL)return/^([a-z]+:)?\/\//i.test(e)||e.startsWith("/")||e.startsWith("./")||e.startsWith("../");if("function"==typeof URL.canParse)try{if(URL.canParse(e,U))return!0;if(I.location?.origin&&URL.canParse(e,I.location.origin))return!0}catch{}try{return new URL(e,U??I.location?.origin??void 0),!0}catch{return!1}},F=async(e,t,n=0)=>{if(P(e)){const o=C(e);if(r())try{const e=await(async e=>{if(!(i||await a()&&i))return null;try{const t=c(e)+".svg",n=await i.getFileHandle(t),s=await n.getFile();return URL.createObjectURL(s)}catch{return null}})(o);if(e)return e}catch{}try{const e=await x((async e=>{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch: ${t.status}`);const n=await t.blob();return r()&&(async(e,t)=>{if(!(i||await a()&&i))return!1;try{const n=c(e)+".svg",s=await i.getFileHandle(n,{create:!0}),o=await s.createWritable();return t instanceof Blob?await o.write(t):await o.write(new Blob([t],{type:"image/svg+xml"})),await o.close(),!0}catch(n){return"undefined"!=typeof console&&console.warn?.("[icon-cache] Failed to cache vector:",e,n),!1}})(e,n).catch(()=>{}),n})(o),2e3);return URL.createObjectURL(e)}catch(s){return n<3&&s instanceof Error&&"Timeout"===s.message?new Promise((i,s)=>{R.push({name:e,creator:t,resolve:i,reject:s,retries:n+1}),S()}):o}}try{return await x((async()=>{const i=await(t?t?.(e):e);if(P(i))return F(i,void 0,n);let s=e;return s=i instanceof Blob||i instanceof File?i:new Blob(['<?xml version="1.0" encoding="UTF-8"?>',"string"==typeof i?i:i.outerHTML],{type:"image/svg+xml"}),P(o=s)?C(o):URL.createObjectURL(o);var o})(),2e3)}catch(s){if(n<3&&s instanceof Error&&"Timeout"===s.message)return new Promise((i,s)=>{R.push({name:e,creator:t,resolve:i,reject:s,retries:n+1}),S()});throw s}},E=async(e,t)=>(P(e)&&(e=C(e)||e),v.getOrInsertComputed(e,()=>F(e,t,0))),T=(()=>{const e='@property --icon-image{syntax:"<image>";inherits:true;initial-value:linear-gradient(#0000,#0000)}@property --icon-color{syntax:"<color>";inherits:true;initial-value:#fff}@layer ui-icon{:host(ui-icon){--icon-size:1.25rem;--icon-color:currentColor;--icon-padding:.125rem}:host(ui-icon){background-color:initial!important;block-size:stretch;box-sizing:border-box;contain:none;content-visibility:visible;display:inline-grid!important;inline-size:max-content;mask-image:none;max-block-size:stretch;max-inline-size:stretch;min-block-size:min(var(--icon-size,fit-content),100%);min-inline-size:min(var(--icon-size,fit-content),100%);padding:var(--icon-padding,.125rem);place-content:center;place-items:center;pointer-events:none;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent;aspect-ratio:1/1;backface-visibility:hidden;color:var(--icon-color,currentColor);font-size:0;grid-template-columns:minmax(0,1fr);grid-template-rows:minmax(0,1fr);line-height:0;object-fit:contain;object-position:center;overflow:visible;transform:translateZ(0);transform-origin:50% 50%;interactivity:inert}:host(ui-icon):before{aspect-ratio:1/1;background-color:var(--icon-color,currentColor)!important;block-size:stretch;border:none;content:"";content-visibility:visible;display:flex;font-size:0;inline-size:stretch;line-height:0;margin:0;mask-clip:content-box;mask-image:var(--icon-image,linear-gradient(#0000,#0000))!important;mask-origin:content-box;mask-position:center;mask-repeat:no-repeat;mask-size:contain;mask-type:alpha;object-fit:contain;object-position:center;outline:none;padding:0;pointer-events:none;transition:background-color .18s ease;user-select:none;interactivity:inert;-webkit-user-select:none;-webkit-tap-highlight-color:transparent;backface-visibility:hidden;overflow:hidden;transform:translateZ(0);transform-origin:50% 50%}}'?.trim?.();if(!e)return()=>null;const t=URL.createObjectURL(new Blob([e],{type:"text/css"}));if("undefined"==typeof document)return null;const i=document.createElement("style");return i.setAttribute("data-ui-phosphor-icon","true"),i.innerHTML=`@import url("${t}");`,()=>i?.cloneNode?.(!0)})();class B extends HTMLElement{static get observedAttributes(){return["icon","icon-style","size","width"]}#e={padding:0,icon:"",iconStyle:"duotone"};#t;#i={inline:k,block:k};#n=null;#s="";#o="";#r={value:""};#c=!1;#a=null;#l;#u=!1;constructor(e={}){super(),Object.assign(this.#e,e),"string"==typeof e.icon&&e.icon.length>0&&this.setAttribute("icon",e.icon),"string"==typeof e.iconStyle&&e.iconStyle.length>0&&this.setAttribute("icon-style",e.iconStyle.toLowerCase()),this.#h()}get icon(){return this.getAttribute("icon")??""}set icon(e){if(null==e||""===e)return void this.removeAttribute("icon");const t=String(e);this.getAttribute("icon")!==t&&this.setAttribute("icon",t)}get iconStyle(){return this.getAttribute("icon-style")??this.#e.iconStyle??"duotone"}set iconStyle(e){const t=(e??"")?.trim?.()?.toLowerCase?.();t?this.getAttribute("icon-style")!==t&&this.setAttribute("icon-style",t):this.removeAttribute("icon-style")}get size(){return this.getAttribute("size")}set size(e){if(null==e||""===e)return void this.removeAttribute("size");const t=String(e);this.getAttribute("size")!==t&&this.setAttribute("size",t)}get width(){return this.getAttribute("width")}set width(e){if(null==e||""===e)return void this.removeAttribute("width");const t="number"==typeof e?String(e):e;this.getAttribute("width")!==t&&this.setAttribute("width",t)}connectedCallback(){if(this.#d(),this.#y(this),this.#p(),!this.#c){const e=T?.()??null;e&&this.shadowRoot.appendChild(e),this.#c=!0}!this.hasAttribute("icon")&&this.#e.icon&&this.setAttribute("icon",this.#e.icon),!this.hasAttribute("icon-style")&&this.#e.iconStyle&&this.setAttribute("icon-style",this.#e.iconStyle);const e=this.#a??this.icon;e?this.updateIcon(e):this.updateIcon()}disconnectedCallback(){this.#t?.disconnect(),this.#t=void 0,this.#f(),this.#n=null,this.#g=0}attributeChangedCallback(e,t,i){if(t!==i)switch(e){case"icon":if(!this.isConnected)return void(this.#a=i??"");this.updateIcon(i??"");break;case"icon-style":if(i){const e=i?.trim?.()?.toLowerCase?.();if(e!==i)return void this.setAttribute("icon-style",e)}if(this.#o="",!this.isConnected)return void(this.#a=this.icon);this.updateIcon();break;case"size":i?this.style.setProperty("--icon-size",i):this.style.removeProperty("--icon-size"),this.isConnected&&this.#m();break;case"width":if(null==i||""===i)this.style.removeProperty("width");else{const e=/^\d+$/.test(i)?`${i}px`:i;this.style.width=e}this.isConnected&&this.#m()}}#g=0;static#b=3;static#v=500;updateIcon(e){const t="string"==typeof e&&e.length>0?e:this.icon,i=t?.trim?.()??"";if(!this.isConnected)return this.#a=i,this;if("undefined"!=typeof IntersectionObserver&&!this.#u)return this.#a=i,this;if(this.#a=null,!i)return this;const n=(this.iconStyle??"duotone")?.trim?.()?.toLowerCase?.(),s=$(i),o=`./assets/icons/${n}/${s}-${n}.svg`,r=`${n}:${s}`;return this.#o=r,requestAnimationFrame(()=>{!this?.checkVisibility?.({contentVisibilityAuto:!0,opacityProperty:!0,visibilityProperty:!0})&&this.#s||E(o)?.then(e=>{e&&this.#o===r&&(this.#s=e,this.#g=0,this.#m())})?.catch(e=>{e instanceof Error&&e.message.includes("Timeout")&&this.#g<B.#b&&this.isConnected?(this.#g++,setTimeout(()=>{this.isConnected&&this.#o===r&&this.updateIcon(i)},B.#v*this.#g)):"undefined"!=typeof console&&console.warn?.("[ui-icon] Failed to load icon",o,e)})}),this}#p(){"undefined"!=typeof IntersectionObserver?this.#l||(this.#l=new IntersectionObserver(e=>{const t=e.some(e=>e.isIntersecting);t!==this.#u&&(this.#u=t,t&&this.updateIcon(this.#a??this.icon))},{rootMargin:"100px"}),this.#l.observe(this),this.addEventListener("contentvisibilityautostatechange",this.#w)):this.#u=!0}#f(){this.#l?.disconnect(),this.#l=void 0,this.removeEventListener("contentvisibilityautostatechange",this.#w)}#w=e=>{!1===e.skipped&&this.updateIcon(this.#a??this.icon)};#h(){this.shadowRoot||this.attachShadow({mode:"open"})}#d(){this.classList.add("ui-icon","u2-icon");try{this.inert=!0}catch{this.setAttribute("inert","")}const e=this.#e.padding;if(!this.style.getPropertyValue("--icon-padding")&&null!=e&&""!==e){const t="number"==typeof e?`${e}rem`:String(e);this.style.setProperty("--icon-padding",t)}const t=this.getAttribute("size");t&&this.style.setProperty("--icon-size",t)}#y(e){if("undefined"!=typeof ResizeObserver&&!this.#t){this.#t=new ResizeObserver(t=>{for(const i of t){if(i.target!==e)continue;const t=i.devicePixelContentBoxSize?.[0],n=Array.isArray(i.contentBoxSize)?i.contentBoxSize[0]:i.contentBoxSize,s="number"==typeof devicePixelRatio&&isFinite(devicePixelRatio)?devicePixelRatio:1;this.#i={inline:(t?.inlineSize??(n?.inlineSize??i.contentRect?.width??e.clientWidth??k)*s)||k,block:(t?.blockSize??(n?.blockSize??i.contentRect?.height??e.clientHeight??k)*s)||k},this.#m()}});try{this.#t.observe(e,{box:"device-pixel-content-box"})}catch{this.#t.observe(e)}}}#m(){if(!this.#s||!this.isConnected)return;if(this.#n)return;const e=Promise.withResolvers();this.#n=e?.promise,requestAnimationFrame(()=>{this.#n=null,e?.resolve();const t=this.#s;if(!t||!this.isConnected)return;const i=this.#k(),n=$(this.icon),s=this.iconStyle;((e,t,i=32)=>{const n=m(e,t,i);return y.has(n)||p.some(e=>e.key===n)})(n,s,i)||((e,t,i)=>{const n="string"==typeof e?e:"",s=C(n),o=s||n,r=((e,t,i)=>{const n=(e??"").trim();return n?`${n}@${i}`:`${t}@${i}`})(t,s,i);if(!o)return Promise.resolve(O(""));const c=M.get(r);if(c)return c;const a=E(o).catch(e=>(o&&"undefined"!=typeof console&&console.warn?.("[ui-icon] Rasterization failed, using SVG mask",e),O(o))).finally(()=>{M.delete(r)});return M.set(r,a),a})(t,this.#o,i).then(e=>{((e,t,i,n=32)=>{const s=m(e,t,n);if(y.has(s))return;if(p.some(e=>e.key===s))return;const o=((e,t)=>{const i=CSS.escape(e),n=CSS.escape(t)||"duotone";return`ui-icon[icon="${i}"][icon-style="${n}"], :host(ui-icon[icon="${i}"][icon-style="${n}"])`})(e,t),r=(c=i)?c.startsWith("url(")?c:`url("${c}")`:"linear-gradient(#0000, #0000)";var c;p.push({selector:o,cssText:`--icon-image: ${r};`,key:s}),f||(f=!0,queueMicrotask(b))})(n,s,e,i),this.#r.value!==e&&(this.#r.value=e)}).catch(e=>{"undefined"!=typeof console&&console.warn?.("[ui-icon] Mask update failed",e)})})}#k(){const e=this,t=Math.ceil(this.#i?.inline||0),i=Math.ceil(this.#i?.block||0),n=Math.max(t,i);if(n>0)return L(n);let s=k;const o="number"==typeof devicePixelRatio&&isFinite(devicePixelRatio)?devicePixelRatio:1;if("function"==typeof e.getBoundingClientRect){const t=e.getBoundingClientRect(),i=Math.max(t.width,t.height)*o;i>0&&(s=i)}return L(s)}}"undefined"==typeof window||customElements.get("ui-icon")||(console.log(B),customElements.define("ui-icon",B)),console.log(B);export{B as U,g as e};