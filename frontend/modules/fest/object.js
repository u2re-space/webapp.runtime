import{isPrimitive as e,hasValue as t,objectAssign as r,makeTriggerLess as n,isNotEqual as l,bindCtx as o,tryParseByHint as s,potentiallyAsync as i,potentiallyAsyncMap as u,callByProp as f,callByAllProp as a,isKeyType as c,isArrayInvalidKey as y,defaultByType as g,$avoidTrigger as p,$getValue as h}from"./core.js";Symbol.observable||=Symbol.for("observable"),Symbol.subscribe||=Symbol.for("subscribe"),Symbol.unsubscribe||=Symbol.for("unsubscribe");const b=Symbol.for("@value"),m=Symbol.for("@extract"),d=Symbol.for("@origin"),S=Symbol.for("@registry"),v=Symbol.for("@behavior"),w=Symbol.for("@promise"),A=Symbol.for("@trigger-less"),R=Symbol.for("@trigger-lock"),P=Symbol.for("@trigger"),x=Symbol.for("@subscribe"),k=Symbol.for("@isNotEqual"),O=/* @__PURE__ */new WeakMap,I=e=>{const t="object"==typeof e||"function"==typeof e?e?.[m]??e:e,r=e=>I(e);return Array.isArray(t)?t?.map?.(r)||Array.from(t||[])?.map?.(r)||[]:t instanceof Map||t instanceof WeakMap?new Map(Array.from(t?.entries?.()||[])?.map?.(([e,t])=>[e,I(t)])):t instanceof Set||t instanceof WeakSet?new Set(Array.from(t?.values?.()||[])?.map?.(r)):null!=t&&"function"==typeof t||"object"==typeof t?Object.fromEntries(Array.from(Object.entries(t||{})||[])?.filter?.(([e])=>e!=m&&e!=d&&e!=S)?.map?.(([e,t])=>[e,I(t)])):t},j=e=>e?.[m]??e?.["@target"]??e,E=(r,n=!1)=>{const l=r;if(e(r)||"symbol"==typeof r)return r;if(null!=r&&(r instanceof WeakRef||"deref"in r&&"function"==typeof r?.deref)&&(r=r?.deref?.()),null!=r&&("object"==typeof r||"function"==typeof r)){r=j(r);const e=n&&t(r)&&r?.value;if(null==e||"object"!=typeof e&&"function"!=typeof e||(r=e),l!=r)return E(r,n)}return r},M=e=>null!=e&&"function"==typeof e.then,W=/* @__PURE__ */new WeakMap,T=new FinalizationRegistry(e=>{e?.forEach?.(e=>e?.())});function N(e,t,r){!r||"function"!=typeof r||"object"!=typeof e&&"function"!=typeof e||(t==Symbol.dispose?W?.getOrInsertComputed?.(e,()=>{const t=/* @__PURE__ */new Set;return"object"!=typeof e&&"function"!=typeof e||(T.register(e,t),W.set(e,t),e[Symbol.dispose]??=()=>t.forEach(e=>{e?.()})),t})?.add?.(r):e[t]=function(...n){const l=e?.[t];"function"==typeof l&&l.apply(this,n),r.apply(this,n)})}class D{constructor(){}deleteProperty(e,t){return Reflect.deleteProperty(e,t)}construct(e,t,r){return Reflect.construct(e,t,r)}apply(e,t,r){return Reflect.apply(e,t,r)}has(e,t){return Reflect.has(e,t)}set(e,t,n){return r(e,n,t),!0}get(e,t,r){return"symbol"==typeof t?e?.[t]??e:Reflect.get(e,t,r)}}const L=e=>{if(e?.[d]||O.has(e))return e;const t=new Proxy(e,new D);return O.set(t,e),t},q=/* @__PURE__ */new WeakMap,z=/* @__PURE__ */new WeakMap,K=/* @__PURE__ */new WeakMap,H=(e,t)=>"symbol"==typeof(e=E(e?.[m]??e))||"object"!=typeof e&&"function"!=typeof e||null==e?e:K.getOrInsertComputed(e,()=>new Proxy(e,((e,t)=>(z.getOrInsert(e?.[m]??e,new $),t))(e,t))),C=Symbol.for("@allProps");class ${compatible;#e;#t=/* @__PURE__ */new WeakSet;#r;#n;#l=/* @__PURE__ */new Set;$safeExec(e,...t){if(e&&!this.#t.has(e)){this.#t.add(e);try{const r=e(...t);return r&&"function"==typeof r.then?r.catch(console.warn):r}catch(r){console.warn(r)}finally{this.#t.delete(e)}}}constructor(){this.#e=/* @__PURE__ */new Map,this.#t=/* @__PURE__ */new WeakSet,this.#n={next:e=>{e&&(Array.isArray(e)?this.#o(...e):this.#o(e))}};const e=new WeakRef(this);this.#r="undefined"!=typeof Observable?new Observable(function(t){const r=t?.next?.bind?.(t);return((e,t,r)=>q.getOrInsert(e,()=>{const n=t?.deref?.();n?.affected?.(r);const l=e?.complete?.bind?.(e),o=()=>{const e=l?.();return n?.unaffected?.(r),e};return e.complete=o,{unaffected:o,[Symbol.dispose]:o,[Symbol.asyncDispose]:o}}))(t,e,r)}):null,this.compatible=()=>this.#r}#o(e,t=null,r,...n){const l=this.#e;if(!l?.size)return;let o=Array.from(l?.entries?.()??[]).map?.(([l,o])=>{if(o===e||o===C||null===o)return this.$safeExec(l,t,e,r,...n)})?.filter?.(e=>e&&"function"==typeof e.then);return o?.length?Promise.allSettled(o):void 0}wrap(e){return Array.isArray(e)?H(e,this):e}affected(e,t){if(null!=e&&"function"==typeof e)return this.#e?.set?.(e,t||C),()=>this.unaffected(e,t||C)}unaffected(e,t){if(null!=e&&"function"==typeof e){const r=this.#e;if(r?.has?.(e)&&(r?.get?.(e)==t||null==t||t==C))return r?.delete?.(e),()=>this.affected(e,t||C)}return this.#e?.clear?.()}trigger(e,t,r,...n){if("symbol"==typeof e)return;if(null!=e&&this.#l.has(e))return;null!=e&&this.#l.add(e);const l=Promise.withResolvers();return queueMicrotask(()=>{try{l.resolve(this.#o(e,t,r,...n)??[])}catch(o){l.reject(o),console.warn(o)}finally{null!=e&&this.#l.delete(e)}}),l.promise}get iterator(){return this.#n}}const F=/* @__PURE__ */new WeakMap,B=(t,r)=>{if(e(t))return t;const n=G(t,r);if(null==n&&"value"!=r){const l=G(t,"value");return null==l||e(l)?n:B(l,r)}return"value"!=r||null==n||e(n)||"function"==typeof n?n:B(n,r)??n},G=(e,t,r)=>{let n;if(null==e)return e;let l=F.getOrInsert(e,/* @__PURE__ */new Set);if(l?.has?.(t))return null;if(function(e,t){let r=!0;try{F?.getOrInsert?.(e,/* @__PURE__ */new Set)?.add?.(t),F?.get?.(e)?.has?.(t)&&(r=!0);const n=Reflect.getOwnPropertyDescriptor(e,t);r="function"==typeof n?.get}catch(n){r=!0}finally{F?.get?.(e)?.delete?.(t)}return r}(e,t)){l?.add?.(t);try{n=Reflect.get(e,t,null!=r?r:e)}catch(s){n=void 0}finally{l.delete(t),0===l?.size&&F?.delete?.(e)}}else n??=Reflect.get(e,t,e);return"function"==typeof n?o(e,n):n},J=(t,r,n)=>null==t||e(t)?t:null!=(["deref","bind","@target",d,m,S]?.indexOf(r)<0?G(t,r)?.bind?.(t):null)?null:[m,d].indexOf(r)>=0?G(t,r)??t:r==b?G(t,r)??G(t,"value"):r==S?n:r==Symbol.observable?n?.compatible:r==Symbol.subscribe?(e,r)=>he(null!=r?[t,r]:t,e):r==Symbol.iterator||r==Symbol.asyncIterator?G(t,r):r==Symbol.dispose?e=>{G(t,Symbol.dispose)?.(e),me(null!=e?[t,e]:t)}:r==Symbol.asyncDispose?e=>{G(t,Symbol.asyncDispose)?.(e),me(null!=e?[t,e]:t)}:r==Symbol.unsubscribe?e=>me(null!=e?[t,e]:t):"symbol"!=typeof r||!(r in t)&&null==G(t,r)?void 0:G(t,r),Q=(e,t,r)=>{if("subscribe"==t)return r?.compatible?.[t]??(t=>{if("function"==typeof t)return he(e,t);if("next"in t&&null!=t?.next){const r=he(e,t?.next),n=t?.complete;return t.complete=(...e)=>(r?.(),n?.(...e)),t.complete}})};class U{#s;#i;#u;constructor(e,t,r){this.#s=e,this.#i=t,this.#u=r}get(e,t,r){return Reflect.get(e,t,r)}apply(e,t,r){let n=[],o=[],s=[],i=[...this.#i],u=-1;const f=Reflect.apply(e,t||this.#i,r);if(this.#u?.[R])return Array.isArray(f)?ee(f):f;switch(this.#s){case"push":u=i?.length,n=r;break;case"unshift":u=0,n=r;break;case"pop":u=i?.length-1,i.length>0&&(o=[[u-1,i[u-1],null]]);break;case"shift":u=0,i.length>0&&(o=[[u,i[u],null]]);break;case"splice":const[e,t,...f]=r;if(u=e,n=t>0?f.slice(t):[],o=t>0?i?.slice?.(f?.length+e,e+(t-(f?.length||0))):[],u+=(t||0)-(f?.length||1),t>0&&f?.length>0)for(let r=0;r<Math.min(t,f?.length??0);r++)s.push([e+r,f[r],i?.[e+r]??null]);break;case"sort":case"fill":case"reverse":case"copyWithin":u=0;for(let r=0;r<i.length;r++)l(i[r],this.#i[r])&&s.push([u+r,this.#i[r],i[r]]);break;case"set":u=r[1],s.push([u,r[0],i?.[u]??null])}const a=z.get(this.#i);return 1==n?.length?a?.trigger?.(u,n[0],null,"@add"):n?.length>1&&(a?.trigger?.(u,n,null,"@addAll"),n.forEach((e,t)=>a?.trigger?.(u+t,e,null,"@add"))),1==s?.length?a?.trigger?.(s[0]?.[0]??u,s[0]?.[1],s[0]?.[2],"@set"):s?.length>1&&(a?.trigger?.(u,s,i,"@setAll"),s.forEach((e,t)=>a?.trigger?.(e?.[0]??u+t,e?.[1],e?.[2],"@set"))),1==o?.length?a?.trigger?.(u,null,o[0],"@remove"):o?.length>1&&(a?.trigger?.(u,null,o,"@removeAll"),o.forEach((e,t)=>a?.trigger?.(u+t,null,e,"@remove"))),f==e?new Proxy(f,this.#u):Array.isArray(f)?ee(f):f}}class V{[R];constructor(){}has(e,t){return Reflect.has(e,t)}get(e,t,r){if([m,d,"@target","deref"].indexOf(t)>=0&&null!=G(e,t)&&G(e,t)!=e)return"function"==typeof G(e,t)?G(e,t)?.bind?.(e):G(e,t);const l=z?.get?.(e),o=J(e,t,l);if(null!=o)return o;const s=Q(e,t,l);if(null!=s)return s;if(t==A)return n.call(this,this);if(t==P)return(t=0)=>z.get(e)?.trigger?.(t,G(e,t),G(e,t),"@set");if("@target"==t||t==m)return e;if("x"==t)return()=>e?.x??e?.[0];if("y"==t)return()=>e?.y??e?.[1];if("z"==t)return()=>e?.z??e?.[2];if("w"==t)return()=>e?.w??e?.[3];if("r"==t)return()=>e?.r??e?.[0];if("g"==t)return()=>e?.g??e?.[1];if("b"==t)return()=>e?.b??e?.[2];if("a"==t)return()=>e?.a??e?.[3];const i=G(e,t)??("value"==t?G(e,b):null);return"function"==typeof i?new Proxy("function"==typeof i?i?.bind?.(e):i,new U(t,e,this)):i}set(e,t,r){if("symbol"!=typeof t&&Number.isInteger(parseInt(t))&&(t=parseInt(t)??t),t==R&&r)return this[R]=!!r,!0;if(t==R&&!r)return delete this[R],!0;const n=G(e,t),o=["x","y","z","w"].indexOf(t),s=["r","g","b","a"].indexOf(t);let i=!1;return i=o>=0?Reflect.set(e,o,r):s>=0?Reflect.set(e,s,r):Reflect.set(e,t,r),"length"==t&&l(n,r)&&((e,t,r,n)=>{const l=Number.isInteger(r)&&Number.isInteger(n)&&n<r?t.slice(n,r):[];if(!e[R]&&r!==n){const e=z.get(t);1===l.length?e?.trigger?.(n,null,l[0],"@remove"):l.length>1&&(e?.trigger?.(n,null,l,"@removeAll"),l.forEach((t,r)=>e?.trigger?.(n+r,null,t,"@remove")));const o=Number.isInteger(r)&&Number.isInteger(n)&&n>r?n-r:0;if(1===o)e?.trigger?.(r,void 0,null,"@add");else if(o>1){const t=Array(o).fill(void 0);e?.trigger?.(r,t,null,"@addAll"),t.forEach((t,n)=>e?.trigger?.(r+n,void 0,null,"@add"))}}})(this,e,n,r),!this[R]&&"symbol"!=typeof t&&l(n,r)&&z?.get?.(e)?.trigger?.(t,r,n,"number"==typeof t?"@set":null),i}deleteProperty(e,t){if("symbol"!=typeof t&&Number.isInteger(parseInt(t))&&(t=parseInt(t)??t),t==R)return delete this[R],!0;const r=G(e,t),n=Reflect.deleteProperty(e,t);return this[R]||"length"==t||t==R||"symbol"==typeof t||null!=r&&z.get(e)?.trigger?.(t,t,r,"number"==typeof t?"@delete":null),n}}class X{[R];constructor(){}get(r,l,i){if([m,d,"@target","deref"].indexOf(l)>=0&&null!=G(r,l)&&G(r,l)!=r)return"function"==typeof G(r,l)?o(r,G(r,l)):G(r,l);const u=z.get(r),f=J(r,l,u);if(null!=f)return f;const a=Q(r,l,u);return null!=a?a:(null!=G(r,l)||"value"==l||!t(r)||"object"!=typeof G(r,"value")&&"function"!=typeof G(r,"value")||null==G(r,"value")||null==G(G(r,"value"),l)||(r=G(r,"value")),l==A?n.call(this,this):l==P?(e="value")=>{const t=G(r,"value"==e?b:e);return z.get(r)?.trigger?.(e,G(r,e),t??G(r,e))}:l==Symbol.toPrimitive?t=>{const n=B(r,l);return G(n,l)?G(n,l)?.(t):e(n)?s(n,t):e(G(n,"value"))?s(G(n,"value"),t):s(G(n,"value")??n,t)}:l==Symbol.toStringTag?()=>{const t=B(r,l);return G(t,l)?G(t,l)?.():e(t)?String(t??"")||"":e(G(t,"value"))?String(G(t,"value")??"")||"":String(G(t,"value")??t??"")||""}:"toString"==l?()=>{const t=B(r,l);return G(t,l)?G(t,l)?.():G(t,Symbol.toStringTag)?G(t,Symbol.toStringTag)?.():e(t)?String(t??"")||"":e(G(t,"value"))?String(G(t,"value")??"")||"":String(G(t,"value")??t??"")||""}:"valueOf"==l?()=>{const t=B(r,l);return G(t,l)?G(t,l)?.():G(t,Symbol.toPrimitive)?G(t,Symbol.toPrimitive)?.():e(t)?t:e(G(t,"value"))?G(t,"value"):G(t,"value")??t}:"symbol"!=typeof l||!(l in r)&&null==G(r,l)?B(r,l):G(r,l))}apply(e,t,r){return Reflect.apply(e,t,r)}ownKeys(e){return Reflect.ownKeys(e)}construct(e,t,r){return Reflect.construct(e,t,r)}isExtensible(e){return Reflect.isExtensible(e)}getOwnPropertyDescriptor(e,t){let r;try{F?.getOrInsert?.(e,/* @__PURE__ */new Set)?.add?.(t),F?.get?.(e)?.has?.(t)&&(r=void 0),r=Reflect.getOwnPropertyDescriptor(e,t)}catch(n){r=void 0}finally{F?.get?.(e)?.delete?.(t)}return r}has(e,t){return t in e}set(e,r,n){return i(n,o=>{if(r==R&&n)return this[R]=!!n,!0;if(r==R&&!n)return delete this[R],!0;const s=e;if(null!=G(e,r)||"value"==r||!t(e)||"object"!=typeof G(e,"value")&&"function"!=typeof G(e,"value")||null==G(e,"value")||null==G(G(e,"value"),r)||(e=G(e,"value")),"symbol"==typeof r&&(null==G(e,r)||!(r in e)))return;const i="value"==r?G(e,b)??G(e,r):G(e,r);e[r]=o;const u=G(e,r)??o;return!this[R]&&"symbol"!=typeof r&&(G(e,k)??l)?.(i,u)&&z?.get?.(s)?.trigger?.(r,o,i),!0})}deleteProperty(e,t){if(t==R)return delete this[R],!0;const r=G(e,t),n=Reflect.deleteProperty(e,t);return this[R]||t==R||"symbol"==typeof t||z.get(e)?.trigger?.(t,null,r),n}}class Y{constructor(){}get(e,t,r){if([m,d,"@target","deref"].indexOf(t)>=0&&null!=G(e,t)&&G(e,t)!=e)return"function"==typeof G(e,t)?o(e,G(e,t)):G(e,t);const s=z.get(e),i=J(e,t,s);if(null!=i)return i;const f=Q(e,t,s);if(null!=f)return f;e=G(e,m)??G(e,d)??e;const a=o(e,G(e,t));return"symbol"!=typeof t||!(t in e)&&null==G(e,t)?t==A?n.call(this,this):t==P?t=>{if(null!=t)return z.get(e)?.trigger?.(t,e?.get?.(t),e?.get?.(t),"@set")}:"clear"==t?()=>{const t=Array.from(e?.entries?.()||[]),r=a();return t.forEach(([t,r])=>{!this[R]&&r&&z.get(e)?.trigger?.(t,null,r)}),r}:"delete"==t?(t,r=null)=>{const n=e.get(t),l=a(t);return!this[R]&&n&&z.get(e)?.trigger?.(t,null,n),l}:"set"==t?(t,r)=>u(r,n=>{const o=e.get(t),s=a(t,r);return l(o,s)&&(this[R]||z.get(e)?.trigger?.(t,s,o)),s}):a:a}set(e,t,r){return t==R?(this[R]=!!r,!0):t!=R||r?Reflect.set(e,t,r):(delete this[R],!0)}has(e,t){return Reflect.has(e,t)}apply(e,t,r){return Reflect.apply(e,t,r)}construct(e,t,r){return Reflect.construct(e,t,r)}ownKeys(e){return Reflect.ownKeys(e)}isExtensible(e){return Reflect.isExtensible(e)}getOwnPropertyDescriptor(e,t){let r;try{F?.getOrInsert?.(e,/* @__PURE__ */new Set)?.add?.(t),F?.get?.(e)?.has?.(t)&&(r=void 0),r=Reflect.getOwnPropertyDescriptor(e,t)}catch(n){r=void 0}finally{F?.get?.(e)?.delete?.(t)}return r}deleteProperty(e,t){return t==R?(delete this[R],!0):Reflect.deleteProperty(e,t)}}class Z{[R]=!1;constructor(){}get(e,t,r){if([m,d,"@target","deref"].indexOf(t)>=0&&null!=G(e,t)&&G(e,t)!=e)return"function"==typeof G(e,t)?o(e,G(e,t)):G(e,t);const s=z.get(e),i=J(e,t,s);if(null!=i)return i;const u=Q(e,t,s);if(null!=u)return u;e=G(e,m)??G(e,d)??e;const f=o(e,G(e,t));return"symbol"!=typeof t||!(t in e)&&null==G(e,t)?t==A?n.call(this,this):t==P?t=>{if(null!=t)return z.get(e)?.trigger?.(t,e?.has?.(t),e?.has?.(t))}:"clear"==t?()=>{const t=Array.from(e?.values?.()||[]),r=f();return t.forEach(t=>{!this[R]&&t&&z.get(e)?.trigger?.(null,null,t)}),r}:"delete"==t?t=>{const r=e.has(t)?t:null,n=f(t);return!this[R]&&r&&z.get(e)?.trigger?.(t,null,r),n}:"add"==t?t=>{const r=e.has(t)?t:null,n=f(t);return l(r,t)&&(this[R]||r||z.get(e)?.trigger?.(t,t,r)),n}:f:f}set(e,t,r){return t==R&&r?(this[R]=!!r,!0):t!=R||r?Reflect.set(e,t,r):(delete this[R],!0)}has(e,t){return Reflect.has(e,t)}apply(e,t,r){return Reflect.apply(e,t,r)}construct(e,t,r){return Reflect.construct(e,t,r)}ownKeys(e){return Reflect.ownKeys(e)}isExtensible(e){return Reflect.isExtensible(e)}getOwnPropertyDescriptor(e,t){let r;try{F?.getOrInsert?.(e,/* @__PURE__ */new Set)?.add?.(t),F?.get?.(e)?.has?.(t)&&(r=void 0),r=Reflect.getOwnPropertyDescriptor(e,t)}catch(n){r=void 0}finally{F?.get?.(e)?.delete?.(t)}return r}deleteProperty(e,t){return t==R?(delete this[R],!0):Reflect.deleteProperty(e,t)}}const _=e=>!("object"!=typeof e&&"function"!=typeof e||null==e||!e?.[m]&&!e?.[x]),ee=e=>_(e)?e:H(e,new V),te=(e,t)=>{const r=e instanceof Promise||"function"==typeof e?.then,n=se({[w]:r?e:null,[b]:r?0:Number(E(e)||0)||0,[v]:t,[Symbol?.toStringTag](){return String(this?.[b]??"")||""},[Symbol?.toPrimitive](e){return s(("object"!=typeof this?.[b]?this?.[b]:this?.[b]?.value||0)??0,e)},set value(e){this[b]=(null==e||Number.isNaN(e)?this[b]:Number(e))||0},get value(){return Number(this[b]||0)||0}});return e?.then?.(e=>n.value=e),n},re=(e,t)=>{const r=e instanceof Promise||"function"==typeof e?.then,n=se({[w]:r?e:null,[b]:(r?"":String(E("number"==typeof e?String(e):e||"")))??"",[v]:t,[Symbol?.toStringTag](){return String(this?.[b]??"")??""},[Symbol?.toPrimitive](e){return s(this?.[b]??"",e)},set value(e){this[b]=String("number"==typeof e?String(e):e||"")??""},get value(){return String(this[b]??"")??""}});return e?.then?.(e=>n.value=e),n},ne=(e,t)=>{const r=e instanceof Promise||"function"==typeof e?.then,n=se({[w]:r?e:null,[b]:!(r||null==E(e)||"string"!=typeof E(e)&&!E(e)),[v]:t,[Symbol?.toStringTag](){return String(this?.[b]??"")||""},[Symbol?.toPrimitive](e){return s(!!this?.[b]||!1,e)},set value(e){this[b]=(null!=e?"string"==typeof e||!!e:this[b])||!1},get value(){return this[b]||!1}});return e?.then?.(e=>n.value=e),n},le=(e,t)=>{const r=e instanceof Promise||"function"==typeof e?.then,n=se({[w]:r?e:null,[v]:t,[Symbol?.toStringTag](){return String(this.value??"")||""},[Symbol?.toPrimitive](e){return s(this.value,e)},value:r?null:E(e)});return e?.then?.(e=>n.value=e),n},oe=(e,t)=>{switch(typeof e){case"boolean":return ne(e,t);case"number":return te(e,t);case"string":return re(e,t);case"object":if(null!=e)return se(e);default:return le(e,t)}},se=(e,t="")=>{if(null==e||"symbol"==typeof e||"object"!=typeof e&&"function"!=typeof e||_(e))return e;if(null==(e=E?.(e))||e instanceof Promise||e instanceof WeakRef||_(e))return e;const r=e;if(null==r||"symbol"==typeof r||"object"!=typeof r&&"function"!=typeof r||r instanceof Promise||r instanceof WeakRef)return r;let n=r;return Array.isArray(r)?(n=ee(e),n):r instanceof Map||r instanceof WeakMap?(n=_(s=e)?s:H(s,new Y),n):r instanceof Set||r instanceof WeakSet?(n=_(o=e)?o:H(o,new Z),n):"function"==typeof r||"object"==typeof r?(n=_(l=e)?l:H(l,new X),n):n;var l,o,s},ie=e=>"undefined"!=typeof HTMLInputElement&&e instanceof HTMLInputElement||!("object"!=typeof e&&"function"!=typeof e||null==e||!(e?.[m]||e?.[x]||z?.has?.(e))),ue=/* @__PURE__ */new WeakMap,fe=e=>{if("symbol"!=typeof e&&null!=e&&("object"==typeof e||"function"==typeof e))return e},ae=(e,t,r,n=null)=>{if(!e)return;if(!fe(e))return;const l=t!=Symbol.iterator?t:null;let o=e?.[S]??z.get(e);e=e?.[m]??e,queueMicrotask(()=>{null!=l&&l!=Symbol.iterator?f(e,l,r):a(e,r)});let s=o?.affected?.(r,l);return e?.[Symbol.dispose]||(N(s,Symbol.dispose,s),N(s,Symbol.asyncDispose,s),N(e,Symbol.dispose,s),N(e,Symbol.asyncDispose,s)),s},ce=(e,t,r,n=null)=>{const l={};let o=e?.value;const s=e=>{r?.(e?.target?.value,"value",o),o=e?.target?.value};return e?.addEventListener?.("change",s,l),()=>e?.removeEventListener?.("change",s,l)},ye=e=>Array.isArray(e)&&2==e?.length&&fe(e?.[0])&&(c(e?.[1])||e?.[1]==Symbol.iterator),ge=(e,t,r,n=null)=>{const l=c(e?.[1])?e?.[1]:null;return he(e?.[0],l,r,n)},pe=(e,t,r,n=null)=>e?.then?.(e=>he?.(e,t,r,n))?.catch?.(e=>(console.warn(e),null)),he=(t,r,n=()=>{},l)=>{if("function"==typeof r&&(n=r,r=null),e(t)||"symbol"==typeof t)return queueMicrotask(()=>n?.(t,null,null,null));if("function"==typeof t?.[x])return t?.[x]?.(n,r,l);if(fe(t)){const e=t;return t=t?.[m]??t,ue?.has?.(t)?ue?.get?.(t)?.(e,r,n,l):ie(e)||ye(t)&&ie(t?.[0])?M(t)?ue?.getOrInsert?.(t,pe)?.(t,r,n,l):ye(t)?ue?.getOrInsert?.(t,ge)?.(t,r,n,l):"undefined"!=typeof HTMLInputElement&&t instanceof HTMLInputElement?ue?.getOrInsert?.(t,ce)?.(t,r,n,l):ue?.getOrInsert?.(t,ae)?.(e,r,n,l):queueMicrotask(()=>ye(t)?f?.(t?.[0],t?.[1],n):null!=r&&r!=Symbol.iterator?f?.(t,r,n):a?.(t,n))}},be=(e,t,r=null)=>Array.isArray(e)?he([e,Symbol.iterator],t,r):e instanceof Set?he([Se(e),Symbol.iterator],t,r):(Map,he(e,t,r)),me=(t,r,n=null)=>((t,r)=>e(t)||"function"==typeof t?r?.(t):M(t)?t.then(r):t?.promise&&M(t.promise)?t.promise.then(r):r?.(t))(t,e=>{const t=Array.isArray(e)&&2==e?.length&&["object","function"].indexOf(typeof e?.[0])>=0&&c(e?.[1]),n=t?e?.[1]:null,l="object"==typeof(e=t&&null!=n?e?.[0]??e:e)||"function"==typeof e?e?.[m]??e:e;let o=e?.[S]??z.get(l);o?.unaffected?.(r,n)}),de=(r,n,l,o)=>{if(e(r))return r?n:l;const i=e=>(null!=e&&(r.value=t(e)?e?.value:e),(t(r)?r?.value:r)?n:l),u=se({[b]:i(),[v]:o,[Symbol?.toStringTag](){return String(i()??this[b]??"")||""},[Symbol?.toPrimitive](e){return s(i()??this[b],e)},set value(e){this[b]=i(e)},get value(){return this[b]=i()??this[b]}}),f=he([r,"value"],e=>{u?.[P]?.()});return N(u,Symbol.dispose,f),u},Se=e=>{const t=se([]);return t.push(...Array.from(e?.values?.()||[])),N(t,Symbol.dispose,he(e,(e,r,n)=>{if(l(e,n))if(null==n&&null!=e)t.push(e);else if(null!=n&&null==e){const e=t.indexOf(n);e>=0&&t.splice(e,1)}else{const r=t.indexOf(n);r>=0&&l(t[r],e)&&(t[r]=e)}})),t},ve=e=>{const t=se([]),r=Array.from(e.entries());return t.push(...r),N(t,Symbol.dispose,he(e,(e,r,n)=>{if(l(e,n)||null==n&&null!=e||null!=n&&null==e)if(null!=n&&null==e){let e=t.findIndex(([e,t])=>e==r);e<0&&(e=t.findLastIndex(([e,t])=>n===t)),e>=0&&t.splice(e,1)}else{let n=t.findIndex(([e,t])=>e==r);n>=0&&n<t.length?l(t[n]?.[1],e)&&(t[n]=[r,e]):t.push([r,e])}})),t},we=/* @__PURE__ */new WeakMap,Ae=(e,t,r="value")=>{const n="function"==typeof e?.[1]&&2==e?.length,o="function"==typeof t?.[1]&&2==t?.length,s=o?t?.[1]:null,i=(c(e?.[1])||e?.[1]==Symbol.iterator)&&2==e?.length;let u=i&&!n?e?.[1]:Array.isArray(e)?null:r;i||n||(e=[e,u]),n&&(e[1]=u);const f=(c(t?.[1])||t?.[1]==Symbol.iterator)&&2==t?.length;let a=f&&!o?t?.[1]:Array.isArray(t)?null:r;if(f||o||(t=[t,a]),o&&(t[1]=a),null==u||null==a||y(u,e?.[0])||y(a,t?.[0]))return;if(("object"!=typeof t?.[0]&&"function"!=typeof t?.[0]||null==t?.[0])&&!Array.isArray(e[0]))return p(t,()=>{e[0][u]=t?.[0]}),()=>{};const g=(e,t)=>{const r=d?.deref?.(),n=m?.deref?.();if(we?.get?.(r)?.get?.(u)?.bound==n){let o=null;const s=we?.get?.(r)?.get?.(u)?.cmpfx;p(n,()=>{o="function"==typeof s?s?.(h(n)??e,t,null):n?.[t]??e});const i=h(o);l(r[u],i)&&p(n,()=>{r[u]=i})}else{const e=we?.get?.(r),t=e?.get?.(u);t?.dispose?.()}},b=()=>{const e=d?.deref?.(),t=we?.get?.(e),r=t?.get?.(u);t?.delete?.(u),r?.unsub?.()},m=null==t?.[0]||"object"!=typeof t?.[0]&&"function"!=typeof t?.[0]||t?.[0]instanceof WeakRef||"function"==typeof t?.[0]?.deref?t?.[0]:new WeakRef(t?.[0]),d=null==e?.[0]||"object"!=typeof e?.[0]&&"function"!=typeof e?.[0]||e?.[0]instanceof WeakRef||"function"==typeof e?.[0]?.deref?e?.[0]:new WeakRef(e?.[0]);let S={dispose:b,cmpfx:s};const v=d?.deref?.(),w=m?.deref?.();if(d instanceof WeakRef){we?.get?.(v)?.get?.(u)?.bound!=w&&we?.get?.(v)?.delete?.(u);const e=we?.getOrInsert?.(v,/* @__PURE__ */new Map);S=e?.getOrInsertComputed?.(u,()=>({bound:w,cmpfx:s,unsub:null,compute:g,dispose:b})),S.unsub=he(t,g),S.cmpfx=s,N(v,Symbol.dispose,S?.dispose),N(w,Symbol.dispose,S?.dispose)}return w&&!Array.isArray(w)&&p(v,()=>{w[a]??=v?.[u]??w[a]}),S?.dispose},Re=(e,t,r,n="value")=>{const l="function"==typeof e?.[1]&&2==e?.length,o=(c(e?.[1])||e?.[1]==Symbol.iterator)&&2==e?.length;let i=o&&!l?e?.[1]:Array.isArray(e)?null:n;if(o||l||(e=[o?e?.[0]:e,i]),l&&(e[1]=i),null==i||y(i,e?.[0]))return;const u=r=>{let n;return null!=r&&(n=e[0][i],e[0][i]=r),t?.(e?.[0]?.[i],i,n)},f=u(),a=se({[w]:null,[b]:f,[v]:r,[Symbol?.toStringTag](){return String(u()??this[b]??"")||""},[Symbol?.toPrimitive](e){return s(u()??this[b],e)},set value(e){this[b]=u(e)},get value(){return this[b]=u()??this[b]}}),g=he([e?.[0]??e,i??"value"],()=>a?.[P]?.());return N(a,Symbol.dispose,g),a},Pe=(r,n="value",l,o)=>{if(e(r))return r;if(!Array.isArray(r)||y(r?.[1],r)||!Array.isArray(r?.[0])&&"object"!=typeof r?.[0]&&"function"!=typeof r?.[0]||(r=r?.[0]),null==(n??=Array.isArray(r)?null:"value")||y(n,r))return;if(n&&t(r?.[n])&&ie(r?.[n]))return i=r?.[n],ie(i)?se(i):null;var i;if(n&&"function"==typeof r?.getProperty&&ie(r?.getProperty?.(n)))return r?.getProperty?.(n);const u=se({[b]:r[n]??=l??r[n],[v]:o,[Symbol?.toStringTag](){return String(r?.[n]??this[b]??"")||""},[Symbol?.toPrimitive]:e=>s(r?.[n],e),set value(e){u[R]=!0,r[n]=this[b]=e||g(r[n]),u[R]=!1},get value(){return this[b]=r?.[n]??this[b]}}),f=he([r,n],e=>{u?.[P]?.()});return N(u,Symbol.dispose,f),u};export{P as $,he as a,ne as b,de as c,Ae as d,Re as e,se as f,N as g,x as h,be as i,oe as j,I as k,ie as l,L as m,te as n,ve as o,Pe as p,Se as q,le as r,re as s,j as u};